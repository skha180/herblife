{% extends 'dashboard/base.html' %}

{% block title %}Orders — HerbLife{% endblock %}
{% block header %}Orders{% endblock %}

{% block content %}
<div class="flex flex-col gap-4">

    <!-- Search & Filter -->
    <form method="get" class="flex flex-wrap items-center gap-2 mb-4">
        <input type="text" name="q" value="{{ search_query }}" placeholder="Search by customer name"
            class="px-3 py-2 border rounded flex-1">
        <select name="status" class="px-3 py-2 border rounded">
            <option value="">All Status</option>
            <option value="pending" {% if status_filter == "pending" %}selected{% endif %}>Pending</option>
            <option value="completed" {% if status_filter == "completed" %}selected{% endif %}>Completed</option>
            <option value="delivered" {% if status_filter == "delivered" %}selected{% endif %}>Delivered</option>
            <option value="cancelled" {% if status_filter == "cancelled" %}selected{% endif %}>Cancelled</option>
        </select>
        <button type="submit" class="bg-green-700 text-white px-4 py-2 rounded hover:bg-green-600">Filter</button>
    </form>

    <!-- Orders Table -->
<div class="overflow-x-auto bg-white rounded shadow">
    <table class="min-w-full divide-y divide-gray-200 text-sm">
        <thead class="bg-green-900 text-white">
            <tr>
                <th class="px-4 py-2 text-left">#</th>
                <th class="px-4 py-2 text-left">Customer</th>
                <th class="px-4 py-2 text-left">Product</th>
                <th class="px-4 py-2 text-left">Phone</th>
                <th class="px-4 py-2 text-left">Address</th>
                <th class="px-4 py-2 text-left">Status</th>
                <th class="px-4 py-2 text-left">Date</th>
                <th class="px-4 py-2 text-left">Actions</th>
            </tr>
        </thead>

        <tbody class="divide-y divide-gray-200">
            {% for order in orders %}
            <tr class="hover:bg-gray-50 transition">
                <td class="px-4 py-2">{{ forloop.counter }}</td>
                <td class="px-4 py-2 font-semibold">{{ order.name }}</td>
                <td class="px-4 py-2">{{ order.product.title }}</td>

                <!-- Phone -->
                <td class="px-4 py-2 max-w-[120px] truncate" title="{{ order.phone }}">
                    {{ order.phone }}
                </td>

                <!-- Address -->
                <td class="px-4 py-2 max-w-[180px] whitespace-pre-wrap break-words">
                    {{ order.address }}
                </td>

                <!-- Status -->
                <td class="px-4 py-2">
                    {% if order.status == "pending" %}
                        <span class="px-2 py-1 rounded bg-yellow-400 text-white text-xs">Pending</span>
                    {% elif order.status == "completed" %}
                        <span class="px-2 py-1 rounded bg-green-500 text-white text-xs">Completed</span>
                    {% elif order.status == "cancelled" %}
                        <span class="px-2 py-1 rounded bg-red-500 text-white text-xs">Cancelled</span>
                    {% elif order.status == "delivered" %}
                        <span class="px-2 py-1 rounded bg-green-700 text-white text-xs">Delivered</span>
                    {% endif %}
                </td>

                <!-- Date -->
                <td class="px-4 py-2 whitespace-nowrap">
                    {{ order.created_at|date:"d M Y • h:i A" }}
                </td>

                <!-- Actions -->
                <td class="px-4 py-2 flex flex-wrap gap-2">
                    <a href="{% url 'dashboard_order_edit' order.id %}" 
                       class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-500 text-xs">Edit</a>

                    {% if order.status != "delivered" %}
                    <a href="{% url 'dashboard_order_deliver' order.id %}" 
                       onclick="return confirm('Mark this order as delivered?');"
                       class="px-3 py-1 bg-green-600 text-white rounded hover:bg-green-500 text-xs">Deliver</a>
                    {% endif %}

                    <a href="{% url 'dashboard_order_delete' order.id %}"
                       onclick="return confirm('Are you sure you want to delete this order?');"
                       class="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-500 text-xs">Delete</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="8" class="px-4 py-4 text-center text-gray-500">No orders found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>


    <!-- Pagination  -->
    {% if orders.has_other_pages %}
    <div class="mt-4 flex justify-center space-x-2">
        {% if orders.has_previous %}
        <a href="?page={{ orders.previous_page_number }}" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">Prev</a>
        {% endif %}

        {% for num in orders.paginator.page_range %}
            {% if orders.number == num %}
                <span class="px-3 py-1 bg-green-700 text-white rounded">{{ num }}</span>
            {% else %}
                <a href="?page={{ num }}" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">{{ num }}</a>
            {% endif %}
        {% endfor %}

        {% if orders.has_next %}
        <a href="?page={{ orders.next_page_number }}" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">Next</a>
        {% endif %}
    </div>
    {% endif %}

</div>
{% endblock %}
